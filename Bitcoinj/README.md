# Blockchain 거래 단위 용어

1. UTXO (Unspent Transaction Output)
- 아직 쓰지 않은 잔액이라는 의미, 비트코인 네트워크에서는 잔액이라는 개념은 존재하지 않는다.
- 트랜잭션에 의한 결과물들의 합을 잔액이라는 개념으로 사용 -> UTXO 데이터
- 각 지갑의 UTXO 들은 해당 지갑 주인에 대해 공개키 암호로 잠겨져있음.
- 하나의 Address는 여러 개의 UTXO가 논리적으로 연결.
- 소비해버리면 더 이상 존재하지 않음.
- UTXO의 소멸은 새로운 UTXO를 생성
- 본인의 것으로(소유-개인키 사용으로 푼다.) 묶여있는(잠겨있는-공개키로 암호화되어 있음.) UTXO를 다른 사람의 것으로 묶여있는(잠겨있는-B의 공개키 사용) UTXO로 전환을 시켜야 함.

입력값 = 5 BTC
출력값 = 4.9 BTC/0.1 BTC
4.9는 받는 사람의 지갑에 실제로 들어오는 비트코인, 받는 사람 지갑에서 UTXO 값이 됨.
0.1은 채굴자에게 보내는 수수료, 채굴자의 지갑에서 UTXO 값이 됨.

Example)
A, B가 F에게 1, 2BTC 씩 각각 보내면 F는 UTXO 2개가 됨.
C, D, E가 G에게 3, 4, 10BTC 씩 각각 보내면 G는 UTXO 3개가 됨.
G가 H에게 9BTC를 보낼경우 G가 가진 UTXO 중 9BTC 이상인 것을 찾고 해당 값을 입력값으로 넣음.
H의 지갑에서 출력값으로 찍히는 9BTC제외 10BTC에서 1BTC로 확정, H는 UTXO 1개
총 UTXO 개수는 6


2. 비트코인 거래(UTXO의 소유권 이전)
- 1) 버전: 비트코인 소프트웨어 버전
- 2) 입력값: 입력값의 개수
- 3) 출력값: 출력값의 개수
- 4) 잠금시간: 해당 거래가 블록체인에 추가되는 '가장 빠른 시간', 거래에 담기기 전 일정 시간 잠궈둠.
- 잠금시간 = 0: 블록체인에 바로 추가되기 희망
- 0 < 잠금시간 < 5억: 해당 범위의 숫자는 '블록의 높이', 해당 높이까지 거래는 블록체인에 포함 X
- 5억 < 잠금시간: 실제로 '시간'을 의미 (유닉스 타임스탬프)

거래는 UTXO 조합해 이루어지는데 이 때 필요한 것이 입력값과 출력값
이 조합은 공개키와 개인키를 통해 소유권 이전, 스크립트를 통해 해결

Input: 거래의 수입원천
- txid(Transaction id, Transaction Hash): 사용할 UTXO의 출처인 '이전 거래의 해시값'
- vout(Output index): 사용할 UTXO의 index, 거래 해시가 가리키는 거래 출력물 중 몇번째 UTXO 인지 말함. 0부터 시작
- scriptSig: UTXO를 사용하기 위한 조건을 충족하는 스크립트. 다른 사람으로부터 받은 UTXO를 사용하기 위해 잠금 해제하는 스크립트.
- unlocking script size
- sequence

Output: 지출액
- value: 받는 사람이 받을 BTC 양, 새로 생성하고자 하는 상대방 소유의 UTXO 금
- locking script size
- scriptPubKey: 출력값을 사용할 수 있는 조건 명시, 수신자 외 그 누구도 열지 못하도록 잠그는 스크립트, 개인키로 풀 수 있음.


3. 개인키, 공개키, 주소, 지갑
- 개인키: 자금의 소유권 증명, 자금의 사용 허가, 송금을 위해 개인키를 보유해야함.
- 공개키: 자금을 받을 때 사용. 비트코인은 타원곡선함수(ECDSA)이용해 개인키로부터 공개키 도출.
- 주소: 공개키로부터 해시함수 통해 만들어짐. SHA256, RIPEMD160 해시함수 사용 후 Base58Check Encode 통해 주소 형성.

개인키 -> 공개키 -> 주소


4. 지갑
지갑: 암호화폐를 사용하는 가장 기본적인 사용자 인터페이스, 사용자의 자산, 키와 주소, 잔액, 거래 승인을 관리

- 비결정적 지갑(Non-deterministic Wallet): 시작 시 100개의 랜덤한 개인키 소유 후, 추가로 필요한 경우 생성
(Type-0 nondeterministic Wallet), 잦은 백업, 개인키 보유 문제 때문에 많이 사용X

- 결정적 지갑(Deterministic Wallet): Seed 통해 개인키 형성, 그에 따라 추출키 전부 복원 가능하기에 백업을 한번만 해도 됨.
Hierarchical deterministic(HD Wallet): 비트코인의 가장 기본적인 지갑 구조.
마스터 키 -> 1세대 키 -> 2세대 키
부모 개인키 -> 부모 공개키 -> 자녀 공개키 or 부모 개인키 -> 자녀 개인키 -> 자녀 공개

HD wallet(Hierarchical Deterministic Wallet)
- 여러 개의 주소를 사용하는 지갑
- 매번 코인의 트랜잭션이 발생할때마다 지갑의 주소가 새로 생성
- 내부적으로 추가되고 생성된 적 있는 모든 주소는 계속해서 유효, HD 지갑 내에서 통합되어 관리
- 지갑에서 보여지는 잔액은 이 모든 주소에 들어있는 코인 수의 총합, 수신가능하게 표시되는 주소는 단지 최근에 생성한 주소


5. Account
이더리움에서 사용하고 있는 잔액 방식
- 외부소유계정(Externally Owned Account, EOA): 지갑, 잔액 조회만 가능(누구한테 받았는지 정보 안나옴)
- 컨트랙트 계정(Contract Account, CA): 컨트랙트(코드 소유), 통제 불가